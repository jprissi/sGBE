cmake_minimum_required( VERSION 3.10 )

# add_custom_command(
#     # TARGET gbe
#     OUTPUT opcodes.hpp
#     PRE_BUILD # Call this command pre-build
#     COMMAND PYTHONPATH=${PROJECT_SOURCE_DIR} ${Python_EXECUTABLE} ${PROJECT_SOURCE_DIR}/generate_opcodes.py
#     COMMENT "Generate Opcodes header file"
#     # WORKING_DIRECTORY ${PROJECT_SOURCE_DIR}
# )    
# Set the path to your Python script
set(GENERATE_OPCODES_SCRIPT ${PROJECT_SOURCE_DIR}/generate_opcodes.py)

# Set the output header file generated by the Python script
set(GENERATED_HEADER_FILE ${CMAKE_CURRENT_BINARY_DIR}/opcodes.h)

# Add a custom command to execute the Python script and generate the header file
add_custom_command(
    OUTPUT ${GENERATED_HEADER_FILE}
    COMMAND ${PYTHON_EXECUTABLE} ${GENERATE_OPCODES_SCRIPT}
    DEPENDS ${GENERATE_OPCODES_SCRIPT}
    COMMENT "Generating opcodes header file"
    WORKING_DIRECTORY ${PROJECT_SOURCE_DIR}
)

# Add a custom target that depends on the generated header file
add_custom_target(GenerateOpcodesHeader DEPENDS ${GENERATED_HEADER_FILE})

include_directories(${CMAKE_CURRENT_SOURCE_DIR})

file( GLOB SOURCES *.cpp )

set(CMAKE_CXX_FLAGS "-Wall -Wextra" )
# set(CMAKE_CXX_FLAGS "-Wall -pg" )
set(CMAKE_CXX_FLAGS "-g" ) # -03

set( MAIN_SOURCES main.cpp )
set ( MAIN_EXE_NAME gbe )

add_executable(gbe main.cpp ${SOURCES} ${GENERATED_HEADER_FILE})

# add_custom_command(
#     TARGET gbe
#     # OUTPUT ${PROJECT_SOURCE_DIR}/opcodes.hpp
#     COMMAND PYTHONPATH=${PROJECT_SOURCE_DIR} ${Python_EXECUTABLE} ${PROJECT_SOURCE_DIR}/generate_opcodes.py
#     COMMENT "Regenerating opcodes..."
#     # DEPENDS  ${PROJECT_SOURCE_DIR}/generate_opcodes.py
#     WORKING_DIRECTORY ${PROJECT_SOURCE_DIR}
# )

find_package(SDL2 REQUIRED)
include_directories(${SDL2_INCLUDE_DIRS})
include_directories(${SDL2_INCLUDE_DIRS})

target_link_libraries(gbe ${SDL2_LIBRARIES})

# Install

install( TARGETS ${MAIN_EXE_NAME} RUNTIME DESTINATION bin )